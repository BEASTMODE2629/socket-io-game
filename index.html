<!doctype html>
<html>
  <head>
    <title>Socket Game Blueprint</title>
    <!-- <link rel="stylesheet" href='styles.css'> -->
    <style>
      #game {
        background-color: lightgray;
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
  <div id='playerCount'></div>
  <div id='scores'></div>
  <!-- Size is 10 greater than actual size -->
  <canvas id="game" width="510" height="510"></canvas>


    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      $(function () {
        var socket = io();
        var canvas = document.getElementById('game');
        var ctx = canvas.getContext('2d');

        socket.on('gameStateUpdate', function(gameState){
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // set score info
          document.getElementById('playerCount').innerHTML = "Player count: " + Object.keys(gameState).length
          var scores = ''
          Object.values(gameState).forEach((value, index) => {
            scores += "<p><span style='background-color: " + value.colour + ";'>Player " + String(index+1) + "</span>: " + value.score + "</p>"
          })
          document.getElementById('scores').innerHTML = scores

          // draw players
          Object.keys(gameState).forEach((playerId) => {
            let player = gameState[playerId]
            ctx.fillStyle = player.colour;
            player.squares.forEach((square) => {
              ctx.fillRect(square.x * 10, square.y * 10, 10,10);
            })
          })
        });

        // key handling
        $('html').keydown(function(e) {
          console.log(e)
          if (e.key == "ArrowDown") {
            socket.emit('down');
          } else if (e.key == "ArrowUp") {
            socket.emit('up');
          } else if (e.key == "ArrowLeft") {
            socket.emit('left');
          } else if (e.key == "ArrowRight") {
            socket.emit('right');
          }
        })
      });
    </script>
  </body>
</html>
